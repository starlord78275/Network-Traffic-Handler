<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Traffic Handler - Mobile Client</title>
    <link rel="stylesheet" href="mobile_style.css">
</head>
<body>
    <div class="mobile-container">
        <!-- Header -->
        <div class="mobile-header">
            <h1>ğŸ“± Traffic Client</h1>
            <div class="connection-status disconnected" id="connectionStatus">
                <span class="status-dot"></span>
                <span id="statusText">Disconnected</span>
            </div>
        </div>

        <!-- Server Info -->
        <div class="card info-card">
            <div class="info-text">
                <strong>ğŸ”— Your Server IP:</strong> 192.168.1.11<br>
                <small>Make sure you're on the same WiFi!</small>
            </div>
        </div>

        <!-- Connection Card -->
        <div class="card">
            <h2>ğŸ”— Server Connection</h2>
            <div class="input-group">
                <label>Server IP Address</label>
                <input type="text" id="serverIP" placeholder="192.168.1.11" value="192.168.1.11">
            </div>
            <div class="button-group">
                <button class="btn btn-connect" onclick="connect()">
                    ğŸŸ¢ Connect
                </button>
                <button class="btn btn-disconnect" onclick="disconnect()">
                    ğŸ”´ Disconnect
                </button>
            </div>
        </div>

        <!-- Message Card -->
        <div class="card">
            <h2>ğŸ’¬ Send Message</h2>
            <div class="input-group">
                <label>Your Message</label>
                <textarea id="messageInput" placeholder="Type your message here..." rows="3"></textarea>
            </div>
            <button class="btn btn-send" onclick="sendMessage()">
                <span>Send Message</span>
                <span>ğŸ“¤</span>
            </button>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <h2>âš¡ Quick Messages</h2>
            <div class="quick-actions">
                <button class="quick-btn" onclick="sendQuick('Hello from phone! ğŸ‘‹')">ğŸ‘‹ Hello</button>
                <button class="quick-btn" onclick="sendQuick('Test message ğŸ§ª')">ğŸ§ª Test</button>
                <button class="quick-btn" onclick="sendQuick('Ping ğŸ“¡')">ğŸ“¡ Ping</button>
                <button class="quick-btn" onclick="clearMessages()">ğŸ—‘ï¸ Clear</button>
            </div>
        </div>

        <!-- Messages History -->
        <div class="card">
            <h2>ğŸ“‹ Message History</h2>
            <div class="messages-list" id="messagesList">
                <p class="empty-message">No messages yet. Connect and send something!</p>
            </div>
        </div>
    </div>

    <script>
        let ws = null;
        let messageCount = 0;

        function updateStatus(connected) {
            const status = document.getElementById('connectionStatus');
            const statusText = document.getElementById('statusText');
            
            if (connected) {
                status.className = 'connection-status connected';
                statusText.textContent = 'Connected âœ“';
            } else {
                status.className = 'connection-status disconnected';
                statusText.textContent = 'Disconnected âœ—';
            }
        }

        function addMessage(text, type) {
            const messagesList = document.getElementById('messagesList');
            
            if (messageCount === 0) {
                messagesList.innerHTML = '';
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-bubble ${type}`;
            
            const time = new Date().toLocaleTimeString();
            messageDiv.innerHTML = `
                <div class="bubble-content">
                    <div class="bubble-text">${escapeHtml(text)}</div>
                    <div class="bubble-time">${time}</div>
                </div>
            `;
            
            messagesList.appendChild(messageDiv);
            messagesList.scrollTop = messagesList.scrollHeight;
            messageCount++;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function connect() {
            const serverIP = document.getElementById('serverIP').value.trim();
            
            if (!serverIP) {
                alert('âš ï¸ Please enter server IP address!');
                return;
            }
            
            if (ws && ws.readyState === WebSocket.OPEN) {
                addMessage('Already connected!', 'system');
                return;
            }
            
            addMessage(`Connecting to ${serverIP}:9999...`, 'system');
            
            try {
                ws = new WebSocket(`ws://${serverIP}:9999`);
                
                ws.onopen = function() {
                    updateStatus(true);
                    addMessage('âœ… Connected successfully!', 'system');
                    navigator.vibrate && navigator.vibrate(100);
                };
                
                ws.onmessage = function(event) {
                    addMessage(event.data, 'received');
                    navigator.vibrate && navigator.vibrate(50);
                };
                
                ws.onerror = function() {
                    addMessage('âŒ Connection failed! Check:\n1. Firewall allows port 9999\n2. Server is running\n3. Same WiFi network', 'system');
                };
                
                ws.onclose = function() {
                    updateStatus(false);
                    addMessage('ğŸ”Œ Disconnected from server', 'system');
                    ws = null;
                };
                
            } catch (error) {
                addMessage('âŒ Error: ' + error.message, 'system');
            }
        }

        function disconnect() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.close();
                addMessage('Disconnected by user', 'system');
            } else {
                addMessage('Not connected', 'system');
            }
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) {
                alert('âš ï¸ Please enter a message!');
                return;
            }
            
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                alert('âŒ Not connected! Click Connect first.');
                return;
            }
            
            try {
                ws.send(message);
                addMessage('You: ' + message, 'sent');
                input.value = '';
                navigator.vibrate && navigator.vibrate(30);
            } catch (error) {
                addMessage('âŒ Failed to send: ' + error.message, 'system');
            }
        }

        function sendQuick(message) {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                alert('âŒ Not connected! Click Connect first.');
                return;
            }
            
            ws.send(message);
            addMessage('You: ' + message, 'sent');
            navigator.vibrate && navigator.vibrate(30);
        }

        function clearMessages() {
            const messagesList = document.getElementById('messagesList');
            messagesList.innerHTML = '<p class="empty-message">No messages yet. Connect and send something!</p>';
            messageCount = 0;
        }

        // Welcome message
        window.onload = function() {
            addMessage('ğŸ‘‹ Welcome! Enter server IP and click Connect.', 'system');
        };
    </script>
</body>
</html>
